import{s as c}from"./supabaseClient-Du47UBJl.js";/* empty css              */import"./darkMode-DMjetaZp.js";let g=null,y=null,m=[];document.addEventListener("DOMContentLoaded",()=>{p(),u(),u()});window.navigateToComplaints=function(t){t?window.location.href=`AllComplaints.html?status=${t}`:window.location.href="AllComplaints.html"};async function p(){const{data:{session:t}}=await c.auth.getSession();if(!t){alert("You are not logged in. Redirecting to login page..."),window.location.href="Login.html";return}const{data:n,error:o}=await c.from("admin").select("id, adminfirstname, adminlastname, adminrole").eq("id",t.user.id).single();if(o||!n){alert("Access denied. You are not an admin."),window.location.href="Login.html";return}g=n.id,y=n.adminrole;const e=document.getElementById("welcomeTitle"),l=document.getElementById("welcomeSubtitle");e&&(e.textContent=`Welcome, ${n.adminfirstname} ${n.adminlastname}`),l&&(l.textContent=`${n.adminrole} Dashboard â€” Manage and monitor all ${n.adminrole.toLowerCase()} complaints assigned to you.`),C()}async function C(){try{let t=c.from("complaint").select("*");y!=="Master Admin"&&(t=t.eq("adminid",g));const{data:n,error:o}=await t.order("submitteddate",{ascending:!1});if(o){console.error("Error fetching complaints:",o);return}const{data:e}=await c.from("category").select("categoryid, categoryname"),l={};e&&e.forEach(a=>{l[a.categoryid]=a.categoryname}),m=(n||[]).map(a=>({...a,categoryName:l[a.categoryid]||"Uncategorized"})),h(m),x(m.slice(0,5))}catch(t){console.error("Unexpected error loading complaints:",t)}}function h(t){const n=t.length,o=t.filter(i=>i.complaintstatus==="Pending").length,e=t.filter(i=>i.complaintstatus==="In-Progress").length,l=t.filter(i=>i.complaintstatus==="Resolved").length,a=t.filter(i=>i.complaintstatus==="Deleted").length;document.getElementById("totalCount").textContent=n,document.getElementById("pendingCount").textContent=o,document.getElementById("inProgressCount").textContent=e,document.getElementById("resolvedCount").textContent=l,document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=a),document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=a)}function x(t){const n=document.getElementById("recentActivityTable"),o=document.getElementById("recentActivityCards");if(n&&(n.textContent=""),o&&(o.textContent=""),t.length===0){n&&(n.innerHTML='<tr><td colspan="5" class="py-6 text-center text-gray-500">No recent activity found.</td></tr>'),o&&(o.innerHTML='<p class="text-center text-gray-500 py-4">No recent activity found.</p>');return}t.forEach(e=>{const l=new Date(e.submitteddate).toLocaleDateString();let a="bg-gray-200 text-gray-700";if(e.complaintstatus==="Pending"?a="bg-yellow-100 text-yellow-700":e.complaintstatus==="In-Progress"?a="bg-purple-100 text-purple-700":e.complaintstatus==="Resolved"?a="bg-green-100 text-green-700":e.complaintstatus==="Deleted"&&(a="bg-gray-200 text-gray-600"),n){const i=document.getElementById("recentActivityRowTemplate");if(i){const d=i.content.cloneNode(!0);d.querySelector("tr"),d.querySelector(".col-title").textContent=e.complainttitle||"Untitled",d.querySelector(".col-category").textContent=e.categoryName,d.querySelector(".col-date").textContent=l;const r=d.querySelector(".col-status");r.textContent=e.complaintstatus,r.className=`col-status py-1 px-3 rounded-full text-xs font-semibold ${a}`;const s=d.querySelector(".col-link");s.href=`AdminComplaintDetails.html?id=${e.complaintid}`,n.appendChild(d)}}if(o){const i=document.getElementById("activityCardTemplate");if(i){const r=i.content.cloneNode(!0).querySelector("div");r.querySelector(".card-title").textContent=e.complainttitle||"Untitled";const s=r.querySelector(".card-status");s.textContent=e.complaintstatus,s.className=`card-status py-1 px-2 rounded text-[10px] font-bold uppercase tracking-wide whitespace-nowrap ml-2 ${a}`,r.querySelector(".card-category").textContent=e.categoryName,r.querySelector(".card-date").textContent=l;const f=r.querySelector(".card-link");f.href=`AdminComplaintDetails.html?id=${e.complaintid}`,o.appendChild(r)}}})}function u(){const t=document.getElementById("profileButton"),n=document.getElementById("profileMenu");t&&n&&(t.addEventListener("click",e=>{e.stopPropagation(),n.classList.toggle("hidden")}),document.addEventListener("click",()=>{n.classList.add("hidden")}));const o=document.getElementById("headerLogoutBtn");o&&o.addEventListener("click",w)}async function w(){const{error:t}=await c.auth.signOut();t?(console.error("Error signing out:",t),alert("Failed to log out.")):window.location.href="Login.html"}
