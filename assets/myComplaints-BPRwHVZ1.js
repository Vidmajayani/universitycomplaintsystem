import{s as h}from"./darkMode-0kXEi02e.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:C}}=await h.auth.getSession();if(!C){window.location.href="Login.html";return}const S=C.user,c=document.getElementById("tabComplaints"),l=document.getElementById("tabLostFound"),k=document.getElementById("sectionComplaints"),E=document.getElementById("sectionLostFound"),g=document.getElementById("complaintList"),I=document.getElementById("statusFilter"),q=document.getElementById("categoryFilter"),B=document.getElementById("dateSort"),i=document.getElementById("lostItemsList"),_=document.getElementById("lostStatusFilter");let r=[],d=[];const F={Facility:"#009688",Academic:"#8e44ad",Administrative:"#ff9800","Student Disciplinary":"#e91e63",Technical:"#007bff",Other:"#607d8b"},T={Pending:{color:"var(--color-pending)",icon:"â³"},"In-Progress":{color:"var(--color-progress)",icon:"ðŸ”§"},Resolved:{color:"var(--color-resolved)",icon:"âœ…"},Deleted:{color:"#dc3545",icon:"ðŸ—‘ï¸"}},w={Lost:{color:"#ff9800",icon:"â“",text:"Lost"},Claim:{color:"#2196f3",icon:"ðŸ‘€",text:"Match Found (Visit Admin)"},Found:{color:"#4caf50",icon:"âœ…",text:"Returned / Found"},Deleted:{color:"#f44336",icon:"ðŸ—‘ï¸",text:"Deleted"}};function x(e){e==="lostfound"?(l.classList.add("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),l.classList.remove("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),c.classList.remove("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),c.classList.add("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),E.classList.remove("hidden"),k.classList.add("hidden"),M()):(c.classList.add("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),c.classList.remove("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),l.classList.remove("border-[var(--color-eco)]","text-eco-dark","dark:text-blue-400","font-semibold"),l.classList.add("border-transparent","text-gray-500","dark:text-gray-400","font-medium","hover:text-gray-700","dark:hover:text-gray-300"),k.classList.remove("hidden"),E.classList.add("hidden"),D())}c.addEventListener("click",()=>x("complaints")),l.addEventListener("click",()=>x("lostfound")),new URLSearchParams(window.location.search).get("tab")==="lostfound"?x("lostfound"):D();async function D(){const{data:e,error:n}=await h.from("complaint").select(`
        complaintid,
        complainttitle,
        complaintdescription,
        complaintstatus,
        submitteddate,
        complainantid,
        admin_feedback,
        category:categoryid (categoryname)
      `).eq("complainantid",S.id).order("submitteddate",{ascending:!1});if(n){console.error(n),g.innerHTML="<p class='text-center text-red-500'>Failed to load complaints.</p>";return}r=e,f(r)}function f(e){if(g.replaceChildren(),!e||e.length===0){g.innerHTML="<p class='text-center text-gray-500 py-6'>No Complaints Found</p>";return}const n=document.getElementById("complaintCardTemplate");e.forEach(t=>{if(!n)return;const o=n.content.cloneNode(!0),a=o.querySelector("div"),s=T[t.complaintstatus]||{color:"#999",icon:"âšª"};a.style.borderLeft=`5px solid ${s.color}`,o.querySelector(".title").textContent=t.complainttitle,o.querySelector(".desc").textContent=t.complaintdescription;const p=o.querySelector(".category-badge");p.textContent=t.category?.categoryname||"Other",p.style.background=F[t.category?.categoryname]||"#555";const u=o.querySelector(".status-badge");u.innerHTML=`${s.icon} ${t.complaintstatus}`,u.style.color=s.color;const m=o.querySelector(".admin-feedback");t.admin_feedback&&(m.classList.remove("hidden"),m.querySelector(".feedback-text").textContent=t.admin_feedback),o.querySelector(".submitted-date").textContent=`Submitted: ${new Date(t.submitteddate).toLocaleDateString()}`,g.appendChild(o)})}async function M(){i.innerHTML="<p class='text-center text-gray-500 py-6'>Loading...</p>";const{data:e,error:n}=await h.from("lost_and_found").select("*").eq("user_id",S.id).order("reported_date",{ascending:!1});if(n){console.error(n),i.innerHTML="<p class='text-center text-red-500'>Failed to load items.</p>";return}d=e,L(d)}function L(e){if(i.replaceChildren(),!e||e.length===0){i.innerHTML="<p class='text-center text-gray-500 py-6'>No Lost Items Reported</p>";return}const n=document.getElementById("lostItemCardTemplate");e.forEach(t=>{if(!n)return;const o=n.content.cloneNode(!0),a=o.querySelector("div"),s=w[t.status]||w.Lost;a.style.borderLeft=`5px solid ${s.color}`;const p=t.date_lost?new Date(t.date_lost).toLocaleDateString():"Unknown Date";o.querySelector(".item-name").textContent=t.item_name,o.querySelector(".location").textContent=t.location_lost,o.querySelector(".date").textContent=p;const u=o.querySelector(".item-desc");t.description&&(u.classList.remove("hidden"),u.textContent=t.description),o.querySelector(".type-badge").textContent=t.item_type;const m=o.querySelector(".status-badge");if(m.innerHTML=`${s.icon} ${s.text}`,m.style.color=s.color,t.brand||t.primary_color){const y=o.querySelector(".item-details");y.classList.remove("hidden");const v=[];t.brand&&v.push(`Brand: ${t.brand}`),t.primary_color&&v.push(`Color: ${t.primary_color}`),y.textContent=v.join(" â€¢ ")}if(t.admin_feedback){const y=o.querySelector(".admin-feedback");y.classList.remove("hidden"),y.querySelector(".feedback-text").textContent=t.admin_feedback}i.appendChild(o)})}I.addEventListener("change",()=>{const e=I.value,n=e==="all"?r:r.filter(t=>t.complaintstatus===e);f(n)}),q.addEventListener("change",()=>{const e=q.value,n=e==="all"?r:r.filter(t=>t.category?.categoryname===e);f(n)}),B.addEventListener("change",()=>{const e=B.value;r.sort((n,t)=>{const o=new Date(n.submitteddate),a=new Date(t.submitteddate);return e==="newest"?a-o:o-a}),f(r)});const b=document.getElementById("lostDateSort");b&&b.addEventListener("change",()=>{const e=b.value;d.sort((n,t)=>{const o=new Date(n.reported_date),a=new Date(t.reported_date);return e==="newest"?a-o:o-a}),L(d)}),_.addEventListener("change",()=>{const e=_.value,n=e==="all"?d:d.filter(t=>t.status===e);L(n)})});
