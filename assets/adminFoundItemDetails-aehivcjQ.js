import{s as l}from"./darkMode-DwWyDh1G.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:B}}=await l.auth.getSession();if(!B){window.location.href="Login.html";return}const h=new URLSearchParams(window.location.search).get("id");if(!h){alert("No found item ID provided"),window.location.href="AdminLostFound.html";return}await C(h),L();async function C(c){try{const{data:e,error:t}=await l.from("found_items").select("*").eq("found_item_id",c).single();if(t)throw t;console.log("Found item loaded:",e);let n=null;try{const{data:a,error:m}=await l.from("admin").select("adminfirstname, adminlastname, adminrole, profile_pic").eq("id",e.admin_id).single();m?console.error("Admin fetch error:",m):n=a}catch(a){console.error("Admin fetch failed:",a)}const{data:o,error:i}=await l.from("lost_found_attachments").select("*").eq("found_item_id",c);i&&console.error("Attachments error:",i),document.getElementById("databaseId").textContent=e.found_item_id,document.getElementById("itemName").textContent=e.item_name||"N/A",document.getElementById("itemTypeDisplay").textContent=e.item_type||"N/A";const d=document.getElementById("statusBadge");if(d.textContent=e.status,e.status==="Unclaimed"?d.className="px-4 py-1.5 rounded-full text-sm font-bold bg-yellow-100 text-yellow-800 shadow-md":e.status==="Claimed"&&(d.className="px-4 py-1.5 rounded-full text-sm font-bold bg-green-100 text-green-800 shadow-md"),document.getElementById("uploadedDate").textContent=e.created_at?new Date(e.created_at).toLocaleDateString():"N/A",document.getElementById("dateFound").textContent=e.date_found?new Date(e.date_found).toLocaleDateString():"N/A",document.getElementById("timeFound").textContent=e.time_found||"N/A",document.getElementById("locationFound").textContent=e.location_found||"N/A",document.getElementById("brand").textContent=e.brand||"--",document.getElementById("model").textContent=e.model||"--",document.getElementById("serialNumber").textContent=e.serial_number||"--",document.getElementById("primaryColor").textContent=e.primary_color||"--",document.getElementById("secondaryColor").textContent=e.secondary_color||"--",document.getElementById("distFeatures").textContent=e.distinguishing_features||"None specified",document.getElementById("description").textContent=e.description||"No description provided",n){const a=`${n.adminfirstname||""} ${n.adminlastname||""}`.trim()||"Unknown Admin";document.getElementById("adminName").textContent=`${a} (${n.adminrole||"Admin"})`;const m=`${n.adminfirstname?.[0]||""}${n.adminlastname?.[0]||""}`.toUpperCase()||"A";document.getElementById("adminInitials").textContent=m}else document.getElementById("adminName").textContent="Admin Info Unavailable",document.getElementById("adminInitials").textContent="A";if(o&&o.length>0){const a=document.getElementById("imageContainer");a.innerHTML="",o.forEach(m=>{const r=document.createElement("img");r.src=m.file_url,r.alt="Found Item Image",r.className="h-48 w-auto rounded-lg border-2 border-gray-200 dark:border-gray-700 object-cover cursor-pointer hover:scale-105 transition-transform",r.onclick=()=>window.open(m.file_url,"_blank"),a.appendChild(r)})}e.status==="Claimed"&&e.matched_lost_item_id&&await x(e.matched_lost_item_id,e.claim_date)}catch(e){console.error("Error loading found item:",e),alert("Failed to load found item details"),window.location.href="AdminLostFound.html"}}async function x(c,e){try{const{data:t,error:n}=await l.from("lost_and_found").select("item_id, item_name, item_type, location_lost, reported_date, user_id").eq("item_id",c).single();if(n||!t){console.error("Error loading matched lost item:",n);return}const{data:o,error:i}=await l.from("users").select("id, first_name, last_name, email").eq("id",t.user_id).single();i&&console.error("Error loading reporter:",i);const d=document.getElementById("matchedLostItemCard");d&&d.classList.remove("hidden");const a=document.getElementById("matchedLostId");a&&(a.textContent=t.item_id);const m=document.getElementById("matchedLostItemName");m&&(m.textContent=t.item_name||"N/A");const r=document.getElementById("matchedLostItemType");r&&(r.textContent=t.item_type||"N/A");const I=document.getElementById("matchedLostLocation");if(I&&(I.textContent=t.location_lost||"N/A"),o){const f=`${o.first_name||""} ${o.last_name||""}`.trim()||"Unknown User",g=`${o.first_name?.[0]||"U"}${o.last_name?.[0]||""}`.toUpperCase(),s=document.getElementById("matchedReporterName");s&&(s.textContent=f);const u=document.getElementById("matchedReporterEmail");u&&(u.textContent=o.email||"N/A");const E=document.getElementById("matchedReporterId");E&&(E.textContent=o.id);const _=document.getElementById("matchedReporterInitials");_&&(_.textContent=g)}else{const f=document.getElementById("matchedReporterName");f&&(f.textContent="Unknown User");const g=document.getElementById("matchedReporterEmail");g&&(g.textContent="N/A");const s=document.getElementById("matchedReporterId");s&&(s.textContent=t.user_id);const u=document.getElementById("matchedReporterInitials");u&&(u.textContent="U")}const y=document.getElementById("matchedReportedDate");y&&(y.textContent=t.reported_date?new Date(t.reported_date).toLocaleDateString():"N/A");const p=document.getElementById("matchedDateReceived");p&&(p.textContent=e?new Date(e).toLocaleDateString():"N/A")}catch(t){console.error("Error fetching matched lost item:",t)}}function L(){const c=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu");c&&e&&c.addEventListener("click",()=>{e.classList.toggle("-translate-x-full")});const t=document.getElementById("profileButton"),n=document.getElementById("profileMenu");t&&n&&(t.addEventListener("click",d=>{d.stopPropagation(),n.classList.toggle("hidden")}),document.addEventListener("click",d=>{!t.contains(d.target)&&!n.contains(d.target)&&n.classList.add("hidden")}));const o=document.getElementById("headerLogoutBtn"),i=document.getElementById("logoutModal");if(o&&i){o.addEventListener("click",()=>i.classList.remove("hidden"));const d=document.getElementById("cancelLogoutBtn"),a=document.getElementById("confirmLogoutBtn");d&&(d.onclick=()=>i.classList.add("hidden")),a&&(a.onclick=async()=>{await l.auth.signOut(),window.location.href="Login.html"})}}});
