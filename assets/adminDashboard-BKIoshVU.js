import{s as c}from"./darkMode-C5bWaft0.js";let f=null,g=null,m=[];document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:e}}=await c.auth.getSession();if(!e){window.location.href="Login.html";return}p(),x(),E()});window.navigateToComplaints=function(e){e?window.location.href=`AllComplaints.html?status=${e}`:window.location.href="AllComplaints.html"};async function p(){const{data:{session:e}}=await c.auth.getSession();if(!e){alert("You are not logged in. Redirecting to login page..."),window.location.href="Login.html";return}const{data:t,error:a}=await c.from("admin").select("id, adminfirstname, adminlastname, adminrole, profile_pic").eq("id",e.user.id).single();if(a||!t){alert("Access denied. You are not an admin."),window.location.href="Login.html";return}f=t.id,g=t.adminrole;const n=document.getElementById("welcomeTitle"),i=document.getElementById("welcomeSubtitle");n&&(n.textContent=`Welcome, ${t.adminfirstname} ${t.adminlastname}`),i&&(i.textContent=`${t.adminrole} Dashboard â€” Manage and monitor all ${t.adminrole.toLowerCase()} complaints assigned to you.`);const l=document.getElementById("profileButton");l&&t.profile_pic&&(l.innerHTML=`
            <img src="${t.profile_pic}" alt="Profile" class="h-10 w-10 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm">
        `);const o=document.getElementById("navAllComplaints"),d=document.getElementById("mobileNavAllComplaints");o&&(o.style.display="block"),d&&(d.style.display="block"),g==="LostAndFound Admin"&&(o&&(o.style.display="none"),d&&(d.style.display="none")),C()}async function C(){try{let e=c.from("complaint").select("*");g!=="Master Admin"&&(e=e.eq("adminid",f));const{data:t,error:a}=await e.order("submitteddate",{ascending:!1});if(a){console.error("Error fetching complaints:",a);return}const{data:n}=await c.from("category").select("categoryid, categoryname"),i={};n&&n.forEach(o=>{i[o.categoryid]=o.categoryname}),m=(t||[]).map(o=>({...o,categoryName:i[o.categoryid]||"Uncategorized"})),h(m);const l=m.filter(o=>o.complaintstatus!=="Deleted");v(l.slice(0,5))}catch(e){console.error("Unexpected error loading complaints:",e)}}function h(e){const t=e.length,a=e.filter(o=>o.complaintstatus==="Pending").length,n=e.filter(o=>o.complaintstatus==="In-Progress").length,i=e.filter(o=>o.complaintstatus==="Resolved").length,l=e.filter(o=>o.complaintstatus==="Deleted").length;document.getElementById("totalCount").textContent=t,document.getElementById("pendingCount").textContent=a,document.getElementById("inProgressCount").textContent=n,document.getElementById("resolvedCount").textContent=i,document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=l),document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=l)}function v(e){const t=document.getElementById("recentActivityTable"),a=document.getElementById("recentActivityCards");if(t&&(t.textContent=""),a&&(a.textContent=""),e.length===0){t&&(t.innerHTML='<tr><td colspan="5" class="py-6 text-center text-gray-500">No recent activity found.</td></tr>'),a&&(a.innerHTML='<p class="text-center text-gray-500 py-4">No recent activity found.</p>');return}e.forEach(n=>{const i=new Date(n.submitteddate).toLocaleDateString();let l="bg-gray-200 text-gray-700";if(n.complaintstatus==="Pending"?l="bg-yellow-100 text-yellow-700":n.complaintstatus==="In-Progress"?l="bg-purple-100 text-purple-700":n.complaintstatus==="Resolved"?l="bg-green-100 text-green-700":n.complaintstatus==="Deleted"&&(l="bg-gray-200 text-gray-600"),t){const o=document.getElementById("recentActivityRowTemplate");if(o){const d=o.content.cloneNode(!0);d.querySelector("tr"),d.querySelector(".col-title").textContent=n.complainttitle||"Untitled",d.querySelector(".col-category").textContent=n.categoryName,d.querySelector(".col-date").textContent=i;const r=d.querySelector(".col-status");r.textContent=n.complaintstatus,r.className=`col-status py-1 px-3 rounded-full text-xs font-semibold ${l}`;const s=d.querySelector(".col-link");s.href=`AdminComplaintDetails.html?id=${n.complaintid}`,t.appendChild(d)}}if(a){const o=document.getElementById("activityCardTemplate");if(o){const r=o.content.cloneNode(!0).querySelector("div");r.querySelector(".card-title").textContent=n.complainttitle||"Untitled";const s=r.querySelector(".card-status");s.textContent=n.complaintstatus,s.className=`card-status py-1 px-2 rounded text-[10px] font-bold uppercase tracking-wide whitespace-nowrap ml-2 ${l}`,r.querySelector(".card-category").textContent=n.categoryName,r.querySelector(".card-date").textContent=i;const y=r.querySelector(".card-link");y.href=`AdminComplaintDetails.html?id=${n.complaintid}`,a.appendChild(r)}}})}function x(){const e=document.getElementById("headerLogoutBtn");e&&e.addEventListener("click",u);const t=document.getElementById("logoutModal");if(t){const n=document.getElementById("cancelLogoutBtn"),i=document.getElementById("confirmLogoutBtn");n&&n.addEventListener("click",()=>{t.classList.add("hidden")}),i&&i.addEventListener("click",async()=>{const{error:l}=await c.auth.signOut();l&&console.error("Error signing out:",l),window.location.href="Login.html"}),t.addEventListener("click",l=>{l.target===t&&t.classList.add("hidden")})}const a=setInterval(()=>{const n=document.querySelector('#mobileMenu a[href="Login.html"]');if(n)n.addEventListener("click",u),clearInterval(a);else if(document.readyState==="complete"){const i=document.querySelector('#mobileMenu a[href="Login.html"]');i&&i.addEventListener("click",u),clearInterval(a)}},100)}function u(e){e&&e.preventDefault();const t=document.getElementById("logoutModal");t&&t.classList.remove("hidden")}function E(){const e=document.getElementById("adminNotepad"),t=document.getElementById("saveStatus");if(!e)return;const a=localStorage.getItem("admin_scratchpad_notes");a&&(e.value=a);let n;e.addEventListener("input",()=>{t.textContent="Saving...",clearTimeout(n),n=setTimeout(()=>{localStorage.setItem("admin_scratchpad_notes",e.value),t.textContent="Auto-saved",t.classList.add("text-green-600","dark:text-green-400"),setTimeout(()=>{t.classList.remove("text-green-600","dark:text-green-400")},1e3)},500)})}
