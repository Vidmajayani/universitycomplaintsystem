import{s as c}from"./supabaseClient-Du47UBJl.js";/* empty css              */import"./darkMode-DMjetaZp.js";let u=null,g=null,m=[];document.addEventListener("DOMContentLoaded",()=>{y(),h(),v()});window.navigateToComplaints=function(t){t?window.location.href=`AllComplaints.html?status=${t}`:window.location.href="AllComplaints.html"};async function y(){const{data:{session:t}}=await c.auth.getSession();if(!t){alert("You are not logged in. Redirecting to login page..."),window.location.href="Login.html";return}const{data:e,error:a}=await c.from("admin").select("id, adminfirstname, adminlastname, adminrole, profile_pic").eq("id",t.user.id).single();if(a||!e){alert("Access denied. You are not an admin."),window.location.href="Login.html";return}u=e.id,g=e.adminrole;const n=document.getElementById("welcomeTitle"),i=document.getElementById("welcomeSubtitle");n&&(n.textContent=`Welcome, ${e.adminfirstname} ${e.adminlastname}`),i&&(i.textContent=`${e.adminrole} Dashboard â€” Manage and monitor all ${e.adminrole.toLowerCase()} complaints assigned to you.`);const o=document.getElementById("profileButton");o&&e.profile_pic&&(o.innerHTML=`
            <img src="${e.profile_pic}" alt="Profile" class="h-10 w-10 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm">
        `),p()}async function p(){try{let t=c.from("complaint").select("*");g!=="Master Admin"&&(t=t.eq("adminid",u));const{data:e,error:a}=await t.order("submitteddate",{ascending:!1});if(a){console.error("Error fetching complaints:",a);return}const{data:n}=await c.from("category").select("categoryid, categoryname"),i={};n&&n.forEach(o=>{i[o.categoryid]=o.categoryname}),m=(e||[]).map(o=>({...o,categoryName:i[o.categoryid]||"Uncategorized"})),C(m),x(m.slice(0,5))}catch(t){console.error("Unexpected error loading complaints:",t)}}function C(t){const e=t.length,a=t.filter(r=>r.complaintstatus==="Pending").length,n=t.filter(r=>r.complaintstatus==="In-Progress").length,i=t.filter(r=>r.complaintstatus==="Resolved").length,o=t.filter(r=>r.complaintstatus==="Deleted").length;document.getElementById("totalCount").textContent=e,document.getElementById("pendingCount").textContent=a,document.getElementById("inProgressCount").textContent=n,document.getElementById("resolvedCount").textContent=i,document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=o),document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=o)}function x(t){const e=document.getElementById("recentActivityTable"),a=document.getElementById("recentActivityCards");if(e&&(e.textContent=""),a&&(a.textContent=""),t.length===0){e&&(e.innerHTML='<tr><td colspan="5" class="py-6 text-center text-gray-500">No recent activity found.</td></tr>'),a&&(a.innerHTML='<p class="text-center text-gray-500 py-4">No recent activity found.</p>');return}t.forEach(n=>{const i=new Date(n.submitteddate).toLocaleDateString();let o="bg-gray-200 text-gray-700";if(n.complaintstatus==="Pending"?o="bg-yellow-100 text-yellow-700":n.complaintstatus==="In-Progress"?o="bg-purple-100 text-purple-700":n.complaintstatus==="Resolved"?o="bg-green-100 text-green-700":n.complaintstatus==="Deleted"&&(o="bg-gray-200 text-gray-600"),e){const r=document.getElementById("recentActivityRowTemplate");if(r){const d=r.content.cloneNode(!0);d.querySelector("tr"),d.querySelector(".col-title").textContent=n.complainttitle||"Untitled",d.querySelector(".col-category").textContent=n.categoryName,d.querySelector(".col-date").textContent=i;const l=d.querySelector(".col-status");l.textContent=n.complaintstatus,l.className=`col-status py-1 px-3 rounded-full text-xs font-semibold ${o}`;const s=d.querySelector(".col-link");s.href=`AdminComplaintDetails.html?id=${n.complaintid}`,e.appendChild(d)}}if(a){const r=document.getElementById("activityCardTemplate");if(r){const l=r.content.cloneNode(!0).querySelector("div");l.querySelector(".card-title").textContent=n.complainttitle||"Untitled";const s=l.querySelector(".card-status");s.textContent=n.complaintstatus,s.className=`card-status py-1 px-2 rounded text-[10px] font-bold uppercase tracking-wide whitespace-nowrap ml-2 ${o}`,l.querySelector(".card-category").textContent=n.categoryName,l.querySelector(".card-date").textContent=i;const f=l.querySelector(".card-link");f.href=`AdminComplaintDetails.html?id=${n.complaintid}`,a.appendChild(l)}}})}function h(){const t=document.getElementById("headerLogoutBtn");t&&t.addEventListener("click",w)}async function w(){const{error:t}=await c.auth.signOut();t?(console.error("Error signing out:",t),alert("Failed to log out.")):window.location.href="Login.html"}function v(){const t=document.getElementById("adminNotepad"),e=document.getElementById("saveStatus");if(!t)return;const a=localStorage.getItem("admin_scratchpad_notes");a&&(t.value=a);let n;t.addEventListener("input",()=>{e.textContent="Saving...",clearTimeout(n),n=setTimeout(()=>{localStorage.setItem("admin_scratchpad_notes",t.value),e.textContent="Auto-saved",e.classList.add("text-green-600","dark:text-green-400"),setTimeout(()=>{e.classList.remove("text-green-600","dark:text-green-400")},1e3)},500)})}
