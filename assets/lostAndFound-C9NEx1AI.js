import{s as e}from"./darkMode-BCgXZOzb.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:o}}=await e.auth.getSession();if(!o||!o.user){window.location.href="Login.html";return}const f=document.getElementById("lostItemForm"),n=o.user.id;f.addEventListener("submit",async p=>{p.preventDefault();const r=document.getElementById("itemName").value.trim(),a=document.getElementById("itemType").value,y=document.getElementById("brand").value.trim(),_=document.getElementById("model").value.trim(),E=document.getElementById("primaryColor").value.trim(),I=document.getElementById("secondaryColor").value.trim(),b=document.getElementById("serialNumber").value.trim(),l=document.getElementById("locationLost").value.trim(),i=document.getElementById("dateLost").value,v=document.getElementById("timeLost").value,h=document.getElementById("distinguishingFeatures").value.trim(),B=document.getElementById("description").value.trim(),s=document.getElementById("itemImage");if(!r||!a||!l||!i){alert("Please fill in all required fields.");return}try{const{data:t,error:d}=await e.from("admin").select("id").eq("adminrole","LostAndFound Admin").single();if(d||!t){console.error("Error fetching Lost & Found admin:",d),alert("Unable to assign admin. Please contact support.");return}const L=t.id,{data:w,error:m}=await e.from("lost_and_found").insert([{user_id:n,admin_id:L,item_name:r,item_type:a,brand:y||null,model:_||null,primary_color:E||null,secondary_color:I||null,serial_number:b||null,location_lost:l,date_lost:i,time_lost:v||null,distinguishing_features:h||null,description:B||null,status:"Lost"}]).select().single();if(m){console.error("Error submitting report:",m),alert("Failed to submit report. Please try again.");return}const D=w.item_id;if(s.files.length>0){const u=s.files[0],F=u.name.split(".").pop(),C=`lost_${n}_${Date.now()}.${F}`,{data:N,error:c}=await e.storage.from("lost_found_images").upload(C,u);if(c)console.error("Image upload failed:",c),alert("Report submitted, but image upload failed.");else{const{data:U}=e.storage.from("lost_found_images").getPublicUrl(N.path),A=U.publicUrl,{error:g}=await e.from("lost_found_attachments").insert([{lost_item_id:D,file_url:A,file_type:"image",uploaded_at:new Date().toISOString()}]);g&&console.error("Error saving attachment link:",g)}}alert("Lost item reported successfully!"),window.location.href="Mycomplaint.html?tab=lostfound"}catch(t){console.error("Unexpected error:",t),alert("An unexpected error occurred.")}})});
