import{s as a}from"./supabaseClient-CPEeNd1r.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:n}}=await a.auth.getSession();if(n&&n.user){const t=n.user.id,{data:s}=await a.from("admin").select("id").eq("id",t).single();if(s){window.location.href="AdminDashboard.html";return}const{data:m}=await a.from("users").select("id").eq("id",t).single();if(m){window.location.href="UserDashboard.html";return}}const r=document.getElementById("password"),d=document.getElementById("togglePassword"),e=document.getElementById("eyeIcon"),o=document.getElementById("eyeOffIcon");d&&d.addEventListener("click",()=>{r.type==="password"?(r.type="text",e.classList.remove("hidden"),o.classList.add("hidden")):(r.type="password",e.classList.add("hidden"),o.classList.remove("hidden"))})});document.getElementById("loginForm").addEventListener("submit",async n=>{n.preventDefault();const r=document.getElementById("email").value,d=document.getElementById("password").value;try{const{data:e,error:o}=await a.auth.signInWithPassword({email:r,password:d});if(o){alert("Login failed: "+o.message);return}if(!e||!e.user){alert("Login failed: No user data returned.");return}const t=e.user.id,{data:s,error:m}=await a.from("admin").select("adminfirstname, adminlastname, adminrole").eq("id",t).single();if(s){localStorage.setItem("isAdminLoggedIn","true"),localStorage.setItem("adminId",t),localStorage.setItem("adminFirstName",s.adminfirstname),localStorage.setItem("adminLastName",s.adminlastname),localStorage.setItem("adminRole",s.adminrole),window.location.href="AdminDashboard.html";return}const{data:i,error:l}=await a.from("users").select("first_name, last_name, username").eq("id",t).single();if(i){localStorage.setItem("userId",t),localStorage.setItem("firstName",i.first_name),localStorage.setItem("lastName",i.last_name),localStorage.setItem("username",i.username),window.location.href="UserDashboard.html";return}alert("Login successful, but no profile found in Admin or Users table."),await a.auth.signOut()}catch(e){console.error("Login error:",e),alert("Unexpected error: "+e.message)}});
