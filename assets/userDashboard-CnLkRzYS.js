import{s as d}from"./darkMode-U0iCC7-S.js";import"./notifications-BTyRan86.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:r}}=await d.auth.getSession();if(!r){window.location.href="Login.html";return}try{const i=r.user.id,{data:s,error:m}=await d.from("users").select("first_name, last_name").eq("id",i).single();if(m||!s)console.error("Error fetching user data:",m),document.getElementById("welcomeUsername").textContent="Welcome!";else{const{first_name:u,last_name:g}=s;document.getElementById("welcomeUsername").textContent=`Welcome, ${u} ${g}!`}const{data:t,error:n}=await d.from("complaint").select("complaintstatus").eq("complainantid",i);if(n){console.error("Error fetching complaints:",n);return}let a=0,e=0,c=0,l=0;t.forEach(u=>{switch(u.complaintstatus){case"Pending":a++;break;case"In-Progress":e++;break;case"Resolved":c++;break;case"Deleted":l++;break}}),document.getElementById("pendingCount").textContent=a,document.getElementById("inProgressCount").textContent=e,document.getElementById("resolvedCount").textContent=c,document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=l)}catch(o){console.error("Unexpected error:",o),alert("Something went wrong! Check console.")}});async function p(){const{data:{user:r}}=await d.auth.getUser();if(!r)return;const{data:o,error:i}=await d.from("complaint").select(`
      complainttitle,
      complaintdescription,
      complaintstatus,
      submitteddate,
      category:categoryid ( categoryname )
    `).eq("complainantid",r.id).order("submitteddate",{ascending:!1}).limit(5);if(i){console.error("Error fetching complaints:",i);return}const s=document.getElementById("recentComplaintsContainer"),m=document.getElementById("complaintCardTemplate");if(s.innerHTML="",!o||o.length===0){s.innerHTML='<p class="text-gray-500 text-sm">No complaints found.</p>';return}o.forEach(t=>{const n=m.content.cloneNode(!0);n.querySelector(".title").textContent=t.complainttitle,n.querySelector(".description").textContent=t.complaintdescription;const a=n.querySelector(".status");a.textContent=t.complaintstatus,t.complaintstatus==="Pending"?a.classList.add("bg-yellow-100","text-yellow-700"):t.complaintstatus==="In-Progress"?a.classList.add("bg-blue-100","text-blue-700"):t.complaintstatus==="Resolved"?a.classList.add("bg-green-100","text-green-700"):t.complaintstatus==="Deleted"&&a.classList.add("bg-red-100","text-red-700");const e=document.createElement("span");e.classList.add("px-3","py-1","text-xs","font-semibold","rounded-full");const c=t.category?.categoryname||"Other";switch(e.textContent=c,c){case"Facility":e.classList.add("bg-purple-100","text-purple-700");break;case"Academic":e.classList.add("bg-indigo-100","text-indigo-700");break;case"Administrative":e.classList.add("bg-pink-100","text-pink-700");break;case"Student Disciplinary":e.classList.add("bg-red-100","text-red-700");break;case"Technical":e.classList.add("bg-teal-100","text-teal-700");break;default:e.classList.add("bg-gray-100","text-gray-700")}n.querySelector(".footer").appendChild(e);const l=new Date(t.submitteddate);n.querySelector(".date").textContent=l.toLocaleDateString()+" "+l.toLocaleTimeString(),s.appendChild(n)})}p();
