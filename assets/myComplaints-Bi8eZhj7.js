import{s as b}from"./supabaseClient-C2pcRdcq.js";import"./darkMode-0pfczJwG.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:v}}=await b.auth.getSession();if(!v){window.location.href="Login.html";return}const r=document.getElementById("complaintList"),l=document.getElementById("statusFilter"),i=document.getElementById("categoryFilter"),h=document.getElementById("dateSort");let c=[];const w={Facility:"#009688",Academic:"#8e44ad",Administrative:"#ff9800","Student Disciplinary":"#e91e63",Technical:"#007bff",Other:"#607d8b"},E={Pending:{color:"var(--color-pending)",icon:"â³"},"In-Progress":{color:"var(--color-progress)",icon:"ðŸ”§"},Resolved:{color:"var(--color-resolved)",icon:"âœ…"},Deleted:{color:"#dc3545",icon:"ðŸ—‘ï¸"}};async function k(){const{data:t,error:e}=await b.auth.getUser();return e||!t.user?(m("Unable to load user."),null):t.user}async function L(){r.replaceChildren();const t=await k();if(!t)return;const{data:e,error:a}=await b.from("complaint").select(`
        complaintid,
        complainttitle,
        complaintdescription,
        complaintstatus,
        submitteddate,
        complainantid,
        admin_feedback,
        category:categoryid (categoryname)
      `).eq("complainantid",t.id).order("submitteddate",{ascending:!1});if(a){m("Failed to load complaints.");return}c=e,x(c)}function x(t){if(r.replaceChildren(),!t||t.length===0){m("No Complaints Found");return}t.forEach(e=>{const a=document.createElement("div");a.className="rounded-lg p-4 shadow transition-transform duration-200 hover:scale-[1.02] bg-white dark:bg-gray-800";const p=E[e.complaintstatus]||{color:"#999",icon:"âšª"};a.style.borderLeft=`6px solid ${p.color}`,a.style.border="1px solid var(--color-border-light)",a.classList.add("dark:border-gray-700");const g=document.createElement("h2");g.className="text-lg font-bold mb-1 text-gray-900 dark:text-white",g.textContent=e.complainttitle;const y=document.createElement("p");y.className="text-gray-700 dark:text-gray-300 mb-2",y.textContent=e.complaintdescription;const o=document.createElement("span");o.className="px-3 py-1 text-white rounded text-sm inline-block mb-2",o.style.background=w[e.category?.categoryname]||"#555",o.textContent=e.category?.categoryname||"Other";const s=document.createElement("div");s.className="flex items-center gap-2 mt-1 mb-2";const C=document.createElement("span");C.textContent=p.icon;const d=document.createElement("span");d.textContent=e.complaintstatus,d.style.color=p.color,d.className="font-semibold",s.appendChild(C),s.appendChild(d);let n=null;e.admin_feedback&&(n=document.createElement("div"),n.className="mt-3 bg-gray-50 dark:bg-gray-700 p-3 rounded border-l-4 border-gray-400 dark:border-gray-500 text-sm",e.complaintstatus==="Deleted"&&(n.classList.replace("border-gray-400","border-red-500"),n.classList.replace("bg-gray-50","bg-red-50"),n.classList.add("dark:bg-red-900","dark:text-white")),n.innerHTML=`
            <p class="font-bold text-gray-800 dark:text-gray-200 mb-1">
                <i class="fas fa-comment-dots mr-1"></i> Admin Message:
            </p>
            <p class="text-gray-700 dark:text-gray-300">${e.admin_feedback}</p>
        `);const f=document.createElement("p");f.className="text-sm text-gray-500 mt-2",f.textContent="Submitted: "+new Date(e.submitteddate).toLocaleDateString(),a.appendChild(g),a.appendChild(y),a.appendChild(o),a.appendChild(s),n&&a.appendChild(n),a.appendChild(f),r.appendChild(a)})}function m(t){r.replaceChildren();const e=document.createElement("p");e.className="text-center text-gray-600 dark:text-gray-300 py-6",e.textContent=t,r.appendChild(e)}function u(){let t=[...c];l.value!=="all"&&(t=t.filter(e=>e.complaintstatus===l.value)),i.value!=="all"&&(t=t.filter(e=>e.category?.categoryname===i.value)),t.sort((e,a)=>h.value==="newest"?new Date(a.submitteddate)-new Date(e.submitteddate):new Date(e.submitteddate)-new Date(a.submitteddate)),x(t)}l.addEventListener("change",u),i.addEventListener("change",u),h.addEventListener("change",u),L()});
