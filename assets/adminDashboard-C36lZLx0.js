import{s}from"./supabaseClient-Du47UBJl.js";/* empty css              */import"./darkMode-DMjetaZp.js";let u=null,g=null,m=[];document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:t}}=await s.auth.getSession();if(!t){window.location.href="Login.html";return}y(),x(),v()});window.navigateToComplaints=function(t){t?window.location.href=`AllComplaints.html?status=${t}`:window.location.href="AllComplaints.html"};async function y(){const{data:{session:t}}=await s.auth.getSession();if(!t){alert("You are not logged in. Redirecting to login page..."),window.location.href="Login.html";return}const{data:e,error:a}=await s.from("admin").select("id, adminfirstname, adminlastname, adminrole, profile_pic").eq("id",t.user.id).single();if(a||!e){alert("Access denied. You are not an admin."),window.location.href="Login.html";return}u=e.id,g=e.adminrole;const n=document.getElementById("welcomeTitle"),r=document.getElementById("welcomeSubtitle");n&&(n.textContent=`Welcome, ${e.adminfirstname} ${e.adminlastname}`),r&&(r.textContent=`${e.adminrole} Dashboard â€” Manage and monitor all ${e.adminrole.toLowerCase()} complaints assigned to you.`);const i=document.getElementById("profileButton");i&&e.profile_pic&&(i.innerHTML=`
            <img src="${e.profile_pic}" alt="Profile" class="h-10 w-10 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm">
        `),p()}async function p(){try{let t=s.from("complaint").select("*");g!=="Master Admin"&&(t=t.eq("adminid",u));const{data:e,error:a}=await t.order("submitteddate",{ascending:!1});if(a){console.error("Error fetching complaints:",a);return}const{data:n}=await s.from("category").select("categoryid, categoryname"),r={};n&&n.forEach(o=>{r[o.categoryid]=o.categoryname}),m=(e||[]).map(o=>({...o,categoryName:r[o.categoryid]||"Uncategorized"})),C(m);const i=m.filter(o=>o.complaintstatus!=="Deleted");h(i.slice(0,5))}catch(t){console.error("Unexpected error loading complaints:",t)}}function C(t){const e=t.length,a=t.filter(o=>o.complaintstatus==="Pending").length,n=t.filter(o=>o.complaintstatus==="In-Progress").length,r=t.filter(o=>o.complaintstatus==="Resolved").length,i=t.filter(o=>o.complaintstatus==="Deleted").length;document.getElementById("totalCount").textContent=e,document.getElementById("pendingCount").textContent=a,document.getElementById("inProgressCount").textContent=n,document.getElementById("resolvedCount").textContent=r,document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=i),document.getElementById("deletedCount")&&(document.getElementById("deletedCount").textContent=i)}function h(t){const e=document.getElementById("recentActivityTable"),a=document.getElementById("recentActivityCards");if(e&&(e.textContent=""),a&&(a.textContent=""),t.length===0){e&&(e.innerHTML='<tr><td colspan="5" class="py-6 text-center text-gray-500">No recent activity found.</td></tr>'),a&&(a.innerHTML='<p class="text-center text-gray-500 py-4">No recent activity found.</p>');return}t.forEach(n=>{const r=new Date(n.submitteddate).toLocaleDateString();let i="bg-gray-200 text-gray-700";if(n.complaintstatus==="Pending"?i="bg-yellow-100 text-yellow-700":n.complaintstatus==="In-Progress"?i="bg-purple-100 text-purple-700":n.complaintstatus==="Resolved"?i="bg-green-100 text-green-700":n.complaintstatus==="Deleted"&&(i="bg-gray-200 text-gray-600"),e){const o=document.getElementById("recentActivityRowTemplate");if(o){const d=o.content.cloneNode(!0);d.querySelector("tr"),d.querySelector(".col-title").textContent=n.complainttitle||"Untitled",d.querySelector(".col-category").textContent=n.categoryName,d.querySelector(".col-date").textContent=r;const l=d.querySelector(".col-status");l.textContent=n.complaintstatus,l.className=`col-status py-1 px-3 rounded-full text-xs font-semibold ${i}`;const c=d.querySelector(".col-link");c.href=`AdminComplaintDetails.html?id=${n.complaintid}`,e.appendChild(d)}}if(a){const o=document.getElementById("activityCardTemplate");if(o){const l=o.content.cloneNode(!0).querySelector("div");l.querySelector(".card-title").textContent=n.complainttitle||"Untitled";const c=l.querySelector(".card-status");c.textContent=n.complaintstatus,c.className=`card-status py-1 px-2 rounded text-[10px] font-bold uppercase tracking-wide whitespace-nowrap ml-2 ${i}`,l.querySelector(".card-category").textContent=n.categoryName,l.querySelector(".card-date").textContent=r;const f=l.querySelector(".card-link");f.href=`AdminComplaintDetails.html?id=${n.complaintid}`,a.appendChild(l)}}})}function x(){const t=document.getElementById("headerLogoutBtn");t&&t.addEventListener("click",w)}async function w(){const{error:t}=await s.auth.signOut();t?(console.error("Error signing out:",t),alert("Failed to log out.")):window.location.href="Login.html"}function v(){const t=document.getElementById("adminNotepad"),e=document.getElementById("saveStatus");if(!t)return;const a=localStorage.getItem("admin_scratchpad_notes");a&&(t.value=a);let n;t.addEventListener("input",()=>{e.textContent="Saving...",clearTimeout(n),n=setTimeout(()=>{localStorage.setItem("admin_scratchpad_notes",t.value),e.textContent="Auto-saved",e.classList.add("text-green-600","dark:text-green-400"),setTimeout(()=>{e.classList.remove("text-green-600","dark:text-green-400")},1e3)},500)})}
