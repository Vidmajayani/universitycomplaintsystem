import{s as d}from"./supabaseClient-Du47UBJl.js";/* empty css              */import"./darkMode-DMjetaZp.js";const D=document.getElementById("complaintTitle"),g=document.getElementById("statusBadge"),N=document.getElementById("complaintId"),_=document.getElementById("submittedDate"),P=document.getElementById("complaintDescription"),S=document.getElementById("categoryDetailsCard"),T=document.getElementById("categoryName"),I=document.getElementById("categoryFields"),U=document.getElementById("category-field-template"),p=document.getElementById("attachmentsContainer"),q=document.getElementById("attachment-item-template"),u=document.getElementById("avatarInitials"),f=document.getElementById("avatarImage"),B=document.getElementById("complainantName"),k=document.getElementById("complainantRole"),y=document.getElementById("complainantId"),w=document.getElementById("complainantEmail"),L=document.getElementById("complainantDept"),A=document.getElementById("feedbackContainer"),h=document.getElementById("adminInitials"),x=document.getElementById("adminProfileImage"),F=document.getElementById("adminName");let b=null;document.addEventListener("DOMContentLoaded",()=>{if(b=new URLSearchParams(window.location.search).get("id"),!b){alert("No complaint ID provided."),window.location.href="AllComplaints.html";return}const e=document.getElementById("mobileMenuButton"),t=document.getElementById("mobileMenu"),i=document.getElementById("overlay");e&&t&&i&&(e.addEventListener("click",()=>{t.classList.toggle("-translate-x-full"),i.classList.toggle("hidden")}),i.addEventListener("click",()=>{t.classList.add("-translate-x-full"),i.classList.add("hidden")})),M(b)});async function M(n){try{console.log("Loading details for complaint:",n);const{data:e,error:t}=await d.from("complaint").select("*").eq("complaintid",n).single();if(t||!e){console.error("Error fetching complaint:",t),alert("Complaint not found.");return}const{data:i}=await d.from("category").select("categoryname").eq("categoryid",e.categoryid).single(),o=i?i.categoryname:"Unknown";console.log("Category:",o);let a=null;if(e.complainantid){const{data:c,error:m}=await d.from("users").select("*").eq("id",e.complainantid).single();!m&&c?a=c:console.warn("Could not fetch user info:",m)}const{data:s,error:l}=await d.from("complaintattachment").select("*").eq("complaintid",n);l&&console.warn("Error fetching attachments:",l);let C=null,r="";if(o==="Technical"?r="technicalcomplaint":o==="Student Disciplinary"?r="studentbehaviorcomplaint":o==="Facility"?r="facilitycomplaint":o==="Administrative"?r="administrativecomplaint":o==="Academic"?r="academiccomplaint":o==="Other"&&(r="othercomplaint"),r){const{data:c,error:m}=await d.from(r).select("*").eq("complaintid",n).single();m?console.warn(`Error fetching ${r}:`,m):C=c}let v="Unassigned",E=null;if(e.adminid){const{data:c}=await d.from("admin").select("adminfirstname, adminlastname, profile_pic").eq("id",e.adminid).single();c&&(v=`${c.adminfirstname} ${c.adminlastname}`,E=c)}O(e,o,a,v,E),$(o,C),R(s),j(e)}catch(e){console.error("Unexpected error:",e),alert("An error occurred while loading details.")}}function O(n,e,t,i,o){D.textContent=n.complainttitle||"Untitled",N.textContent=`#${n.complaintid}`;const a=new Date(n.submitteddate);if(_.textContent=isNaN(a)?"N/A":a.toLocaleString(),g.textContent=n.complaintstatus,g.className=`px-3 py-1 rounded-full text-xs font-bold border inline-block ${W(n.complaintstatus)}`,g.classList.remove("hidden"),P.textContent=n.complaintdescription||"No description provided.",t)if(B.textContent=`${t.first_name||""} ${t.last_name||""}`,k.textContent=t.role||"Student",y.textContent=t.id||"N/A",y.title=t.id||"",w.textContent=t.email||"N/A",L.textContent=t.department||"N/A",t.profile_image_url)f.src=t.profile_image_url,f.classList.remove("hidden"),u.classList.add("hidden");else{const s=t.first_name?t.first_name[0]:"",l=t.last_name?t.last_name[0]:"";u.innerText=(s+l).toUpperCase()||"U",f.classList.add("hidden"),u.classList.remove("hidden")}else B.textContent="Unknown User",k.textContent="N/A",y.textContent="N/A",w.textContent="N/A",L.textContent="N/A",u.innerText="U",f.classList.add("hidden"),u.classList.remove("hidden");if(F.textContent=i,o&&o.profile_pic)x.src=o.profile_pic,x.classList.remove("hidden"),h.classList.add("hidden");else{const s=i!=="Unassigned"?i.split(" ").map(l=>l[0]).join("").substring(0,2).toUpperCase():"?";h.textContent=s,h.classList.remove("hidden"),x.classList.add("hidden")}}function $(n,e){if(!e)return;S.classList.remove("hidden"),T.textContent=n,I.textContent="";const t=(i,o)=>{const a=U.content.cloneNode(!0),s=a.querySelector(".field-label"),l=a.querySelector(".field-value");s.textContent=i,l.textContent=o||"N/A",o||l.classList.add("italic","text-gray-400"),I.appendChild(a)};n==="Technical"?(t("Type of Issue",e.typeofissue),t("Device Affected",e.deviceaffected),t("Previous Attempts",e.previousattempts)):n==="Student Disciplinary"?(t("Accused Name",e.accusedname),t("Type of Behavior",e.typeofbehavior),t("Location",e.locationofincident),t("Witness Details",e.witnessdetail),t("Previous Attempts",e.previousattempts)):n==="Facility"?(t("Facility Type",e.typeoffacility),t("Issue",e.typeoffacilityissue),t("Floor",e.facilityfloor),t("Previous Attempt",e.previousattempt)):n==="Administrative"?(t("Department",e.complaintdepartment),t("Staff Involved",e.staffinvolved),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts)):n==="Academic"?(t("Lecturer Name",e.lecturername),t("Module Name",e.modulename),t("Batch Code",e.batchcode),t("Level",e.currentlevel),t("Semester",e.semester),t("Issue",e.specificationofissue),t("Phone",e.phone),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts)):n==="Other"&&(t("Suggested Category",e.suggestedcategory),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts))}function R(n){if(!n||n.length===0){p.textContent="";const e=document.createElement("p");e.className="text-gray-500 text-sm italic",e.textContent="No attachments found.",p.appendChild(e);return}p.textContent="",n.forEach(e=>{const t=q.content.cloneNode(!0),i=t.querySelector(".attachment-link"),o=t.querySelector(".attachment-filename"),a=t.querySelector(".attachment-desc");i.href=e.fileurl,o.textContent=e.filename,a.textContent=e.description||"Attachment",p.appendChild(t)})}function j(n){A.textContent="";const e=document.createElement("p");n.admin_feedback?(e.className="text-gray-700 dark:text-gray-300 whitespace-pre-wrap",e.textContent=n.admin_feedback):(e.className="text-gray-500 text-sm italic",e.textContent="No feedback provided yet."),A.appendChild(e)}function W(n){switch(n){case"Pending":return"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800";case"In-Progress":return"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800";case"Resolved":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800";case"Deleted":return"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}}
