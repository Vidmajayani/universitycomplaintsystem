import{s as l}from"./darkMode-DwWyDh1G.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:u}}=await l.auth.getSession();if(!u){window.location.href="Login.html";return}const s=new URLSearchParams(window.location.search).get("id");if(!s){alert("No found item ID provided"),window.location.href="AdminLostFound.html";return}await g(s),y();async function g(i){try{const{data:e,error:d}=await l.from("found_items").select("*").eq("found_item_id",i).single();if(d)throw d;console.log("Found item loaded:",e);let t=null;try{const{data:o,error:r}=await l.from("admin").select("adminfirstname, adminlastname, adminrole, profile_pic").eq("id",e.admin_id).single();r?console.error("Admin fetch error:",r):t=o}catch(o){console.error("Admin fetch failed:",o)}const{data:a,error:m}=await l.from("lost_found_attachments").select("*").eq("found_item_id",i);m&&console.error("Attachments error:",m),document.getElementById("databaseId").textContent=e.found_item_id,document.getElementById("itemName").textContent=e.item_name||"N/A",document.getElementById("itemTypeDisplay").textContent=e.item_type||"N/A";const n=document.getElementById("statusBadge");if(n.textContent=e.status,e.status==="Unclaimed"?n.className="px-4 py-1.5 rounded-full text-sm font-bold bg-yellow-100 text-yellow-800 shadow-md":e.status==="Claimed"&&(n.className="px-4 py-1.5 rounded-full text-sm font-bold bg-green-100 text-green-800 shadow-md"),document.getElementById("uploadedDate").textContent=e.created_at?new Date(e.created_at).toLocaleDateString():"N/A",document.getElementById("dateFound").textContent=e.date_found?new Date(e.date_found).toLocaleDateString():"N/A",document.getElementById("timeFound").textContent=e.time_found||"N/A",document.getElementById("locationFound").textContent=e.location_found||"N/A",document.getElementById("brand").textContent=e.brand||"--",document.getElementById("model").textContent=e.model||"--",document.getElementById("serialNumber").textContent=e.serial_number||"--",document.getElementById("primaryColor").textContent=e.primary_color||"--",document.getElementById("secondaryColor").textContent=e.secondary_color||"--",document.getElementById("distFeatures").textContent=e.distinguishing_features||"None specified",document.getElementById("description").textContent=e.description||"No description provided",t){const o=`${t.adminfirstname||""} ${t.adminlastname||""}`.trim()||"Unknown Admin";document.getElementById("adminName").textContent=`${o} (${t.adminrole||"Admin"})`;const r=`${t.adminfirstname?.[0]||""}${t.adminlastname?.[0]||""}`.toUpperCase()||"A";document.getElementById("adminInitials").textContent=r}else document.getElementById("adminName").textContent="Admin Info Unavailable",document.getElementById("adminInitials").textContent="A";if(a&&a.length>0){const o=document.getElementById("imageContainer");o.innerHTML="",a.forEach(r=>{const c=document.createElement("img");c.src=r.file_url,c.alt="Found Item Image",c.className="h-48 w-auto rounded-lg border-2 border-gray-200 dark:border-gray-700 object-cover cursor-pointer hover:scale-105 transition-transform",c.onclick=()=>window.open(r.file_url,"_blank"),o.appendChild(c)})}e.status==="Claimed"&&e.matched_lost_item_id&&await f(e.matched_lost_item_id)}catch(e){console.error("Error loading found item:",e),alert("Failed to load found item details"),window.location.href="AdminLostFound.html"}}async function f(i){try{const{data:e,error:d}=await l.from("lost_and_found").select("item_id, item_name, item_type, location_lost, reported_date, claim_date, user_id").eq("item_id",i).single();if(d||!e){console.error("Error loading matched lost item:",d);return}const{data:t,error:a}=await l.from("users").select("id, first_name, last_name, email").eq("id",e.user_id).single();if(a&&console.error("Error loading reporter:",a),document.getElementById("matchedLostItemCard").classList.remove("hidden"),document.getElementById("matchedLostId").textContent=e.item_id,document.getElementById("matchedLostItemName").textContent=e.item_name||"N/A",document.getElementById("matchedLostItemType").textContent=e.item_type||"N/A",document.getElementById("matchedLostLocation").textContent=e.location_lost||"N/A",t){const m=`${t.first_name||""} ${t.last_name||""}`.trim()||"Unknown User",n=`${t.first_name?.[0]||"U"}${t.last_name?.[0]||""}`.toUpperCase();document.getElementById("matchedReporterName").textContent=m,document.getElementById("matchedReporterEmail").textContent=t.email||"N/A",document.getElementById("matchedReporterId").textContent=t.id,document.getElementById("matchedReporterInitials").textContent=n}else document.getElementById("matchedReporterName").textContent="Unknown User",document.getElementById("matchedReporterEmail").textContent="N/A",document.getElementById("matchedReporterId").textContent=e.user_id,document.getElementById("matchedReporterInitials").textContent="U";document.getElementById("matchedReportedDate").textContent=e.reported_date?new Date(e.reported_date).toLocaleDateString():"N/A",document.getElementById("matchedDateReceived").textContent=e.claim_date?new Date(e.claim_date).toLocaleDateString():"N/A"}catch(e){console.error("Error fetching matched lost item:",e)}}function y(){const i=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu");i&&e&&i.addEventListener("click",()=>{e.classList.toggle("-translate-x-full")});const d=document.getElementById("profileButton"),t=document.getElementById("profileMenu");d&&t&&(d.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",n=>{!d.contains(n.target)&&!t.contains(n.target)&&t.classList.add("hidden")}));const a=document.getElementById("headerLogoutBtn"),m=document.getElementById("logoutModal");if(a&&m){a.addEventListener("click",()=>m.classList.remove("hidden"));const n=document.getElementById("cancelLogoutBtn"),o=document.getElementById("confirmLogoutBtn");n&&(n.onclick=()=>m.classList.add("hidden")),o&&(o.onclick=async()=>{await l.auth.signOut(),window.location.href="Login.html"})}}});
