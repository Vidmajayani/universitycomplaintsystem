import{s as d}from"./supabaseClient-Du47UBJl.js";/* empty css              */import"./darkMode-DMjetaZp.js";const w=document.getElementById("complaintTitle"),f=document.getElementById("statusBadge"),D=document.getElementById("complaintId"),A=document.getElementById("submittedDate"),N=document.getElementById("complaintDescription"),L=document.getElementById("categoryDetailsCard"),S=document.getElementById("categoryName"),C=document.getElementById("categoryFields"),P=document.getElementById("category-field-template"),p=document.getElementById("attachmentsContainer"),T=document.getElementById("attachment-item-template"),u=document.getElementById("avatarInitials"),g=document.getElementById("avatarImage"),E=document.getElementById("complainantName"),v=document.getElementById("complainantRole"),y=document.getElementById("complainantId"),I=document.getElementById("complainantEmail"),B=document.getElementById("complainantDept"),k=document.getElementById("feedbackContainer"),U=document.getElementById("adminInitials"),_=document.getElementById("adminName");let h=null;document.addEventListener("DOMContentLoaded",()=>{if(h=new URLSearchParams(window.location.search).get("id"),!h){alert("No complaint ID provided."),window.location.href="AllComplaints.html";return}const e=document.getElementById("mobileMenuButton"),t=document.getElementById("mobileMenu"),i=document.getElementById("overlay");e&&t&&i&&(e.addEventListener("click",()=>{t.classList.toggle("-translate-x-full"),i.classList.toggle("hidden")}),i.addEventListener("click",()=>{t.classList.add("-translate-x-full"),i.classList.add("hidden")})),q(h)});async function q(n){try{console.log("Loading details for complaint:",n);const{data:e,error:t}=await d.from("complaint").select("*").eq("complaintid",n).single();if(t||!e){console.error("Error fetching complaint:",t),alert("Complaint not found.");return}const{data:i}=await d.from("category").select("categoryname").eq("categoryid",e.categoryid).single(),o=i?i.categoryname:"Unknown";console.log("Category:",o);let a=null;if(e.complainantid){const{data:r,error:m}=await d.from("users").select("*").eq("id",e.complainantid).single();!m&&r?a=r:console.warn("Could not fetch user info:",m)}const{data:c,error:s}=await d.from("complaintattachment").select("*").eq("complaintid",n);s&&console.warn("Error fetching attachments:",s);let x=null,l="";if(o==="Technical"?l="technicalcomplaint":o==="Student Disciplinary"?l="studentbehaviorcomplaint":o==="Facility"?l="facilitycomplaint":o==="Administrative"?l="administrativecomplaint":o==="Academic"?l="academiccomplaint":o==="Other"&&(l="othercomplaint"),l){const{data:r,error:m}=await d.from(l).select("*").eq("complaintid",n).single();m?console.warn(`Error fetching ${l}:`,m):x=r}let b="Unassigned";if(e.adminid){const{data:r}=await d.from("admin").select("adminfirstname, adminlastname").eq("id",e.adminid).single();r&&(b=`${r.adminfirstname} ${r.adminlastname}`)}F(e,o,a,b),M(o,x),O(c),$(e)}catch(e){console.error("Unexpected error:",e),alert("An error occurred while loading details.")}}function F(n,e,t,i){w.textContent=n.complainttitle||"Untitled",D.textContent=`#${n.complaintid}`;const o=new Date(n.submitteddate);if(A.textContent=isNaN(o)?"N/A":o.toLocaleString(),f.textContent=n.complaintstatus,f.className=`px-3 py-1 rounded-full text-xs font-bold border inline-block ${R(n.complaintstatus)}`,f.classList.remove("hidden"),N.textContent=n.complaintdescription||"No description provided.",t)if(E.textContent=`${t.first_name||""} ${t.last_name||""}`,v.textContent=t.role||"Student",y.textContent=t.id||"N/A",y.title=t.id||"",I.textContent=t.email||"N/A",B.textContent=t.department||"N/A",t.profile_image_url)g.src=t.profile_image_url,g.classList.remove("hidden"),u.classList.add("hidden");else{const c=t.first_name?t.first_name[0]:"",s=t.last_name?t.last_name[0]:"";u.innerText=(c+s).toUpperCase()||"U",g.classList.add("hidden"),u.classList.remove("hidden")}else E.textContent="Unknown User",v.textContent="N/A",y.textContent="N/A",I.textContent="N/A",B.textContent="N/A",u.innerText="U",g.classList.add("hidden"),u.classList.remove("hidden");_.textContent=i;const a=i!=="Unassigned"?i.split(" ").map(c=>c[0]).join("").substring(0,2).toUpperCase():"?";U.textContent=a}function M(n,e){if(!e)return;L.classList.remove("hidden"),S.textContent=n,C.textContent="";const t=(i,o)=>{const a=P.content.cloneNode(!0),c=a.querySelector(".field-label"),s=a.querySelector(".field-value");c.textContent=i,s.textContent=o||"N/A",o||s.classList.add("italic","text-gray-400"),C.appendChild(a)};n==="Technical"?(t("Type of Issue",e.typeofissue),t("Device Affected",e.deviceaffected),t("Previous Attempts",e.previousattempts)):n==="Student Disciplinary"?(t("Accused Name",e.accusedname),t("Type of Behavior",e.typeofbehavior),t("Location",e.locationofincident),t("Witness Details",e.witnessdetail),t("Previous Attempts",e.previousattempts)):n==="Facility"?(t("Facility Type",e.typeoffacility),t("Issue",e.typeoffacilityissue),t("Floor",e.facilityfloor),t("Previous Attempt",e.previousattempt)):n==="Administrative"?(t("Department",e.complaintdepartment),t("Staff Involved",e.staffinvolved),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts)):n==="Academic"?(t("Lecturer Name",e.lecturername),t("Module Name",e.modulename),t("Batch Code",e.batchcode),t("Level",e.currentlevel),t("Semester",e.semester),t("Issue",e.specificationofissue),t("Phone",e.phone),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts)):n==="Other"&&(t("Suggested Category",e.suggestedcategory),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts))}function O(n){if(!n||n.length===0){p.textContent="";const e=document.createElement("p");e.className="text-gray-500 text-sm italic",e.textContent="No attachments found.",p.appendChild(e);return}p.textContent="",n.forEach(e=>{const t=T.content.cloneNode(!0),i=t.querySelector(".attachment-link"),o=t.querySelector(".attachment-filename"),a=t.querySelector(".attachment-desc");i.href=e.fileurl,o.textContent=e.filename,a.textContent=e.description||"Attachment",p.appendChild(t)})}function $(n){k.textContent="";const e=document.createElement("p");n.admin_feedback?(e.className="text-gray-700 dark:text-gray-300 whitespace-pre-wrap",e.textContent=n.admin_feedback):(e.className="text-gray-500 text-sm italic",e.textContent="No feedback provided yet."),k.appendChild(e)}function R(n){switch(n){case"Pending":return"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800";case"In-Progress":return"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800";case"Resolved":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800";case"Deleted":return"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}}
