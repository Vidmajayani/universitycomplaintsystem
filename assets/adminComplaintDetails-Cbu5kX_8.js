import{s}from"./supabaseClient-Du47UBJl.js";/* empty css              */import"./darkMode-DMjetaZp.js";const N=document.getElementById("complaintTitle"),g=document.getElementById("statusBadge"),L=document.getElementById("complaintId"),_=document.getElementById("submittedDate"),S=document.getElementById("complaintDescription"),P=document.getElementById("categoryDetailsCard"),T=document.getElementById("categoryName"),E=document.getElementById("categoryFields"),q=document.getElementById("category-field-template"),u=document.getElementById("attachmentsContainer"),U=document.getElementById("attachment-item-template"),p=document.getElementById("avatarInitials"),f=document.getElementById("avatarImage"),w=document.getElementById("complainantName"),B=document.getElementById("complainantRole"),y=document.getElementById("complainantId"),k=document.getElementById("complainantEmail"),A=document.getElementById("complainantDept"),D=document.getElementById("feedbackContainer"),h=document.getElementById("adminInitials"),b=document.getElementById("adminProfileImage"),F=document.getElementById("adminName");let x=null;document.addEventListener("DOMContentLoaded",()=>{if(x=new URLSearchParams(window.location.search).get("id"),!x){alert("No complaint ID provided."),window.location.href="AllComplaints.html";return}$()});async function $(){const{data:{session:n}}=await s.auth.getSession();if(!n){window.location.href="Login.html";return}const{data:e,error:t}=await s.from("admin").select("id, adminrole, profile_pic").eq("id",n.user.id).single();if(t||!e){alert("Access denied."),window.location.href="Login.html";return}const i=document.getElementById("profileButton");i&&e.profile_pic&&(i.innerHTML=`
            <img src="${e.profile_pic}" alt="Profile" class="h-10 w-10 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm">
        `),O(x)}async function O(n){try{console.log("Loading details for complaint:",n);const{data:e,error:t}=await s.from("complaint").select("*").eq("complaintid",n).single();if(t||!e){console.error("Error fetching complaint:",t),alert("Complaint not found.");return}const{data:i}=await s.from("category").select("categoryname").eq("categoryid",e.categoryid).single(),o=i?i.categoryname:"Unknown";console.log("Category:",o);let a=null;if(e.complainantid){const{data:c,error:m}=await s.from("users").select("*").eq("id",e.complainantid).single();!m&&c?a=c:console.warn("Could not fetch user info:",m)}const{data:d,error:r}=await s.from("complaintattachment").select("*").eq("complaintid",n);r&&console.warn("Error fetching attachments:",r);let C=null,l="";if(o==="Technical"?l="technicalcomplaint":o==="Student Disciplinary"?l="studentbehaviorcomplaint":o==="Facility"?l="facilitycomplaint":o==="Administrative"?l="administrativecomplaint":o==="Academic"?l="academiccomplaint":o==="Other"&&(l="othercomplaint"),l){const{data:c,error:m}=await s.from(l).select("*").eq("complaintid",n).single();m?console.warn(`Error fetching ${l}:`,m):C=c}let v="Unassigned",I=null;if(e.adminid){const{data:c}=await s.from("admin").select("adminfirstname, adminlastname, profile_pic").eq("id",e.adminid).single();c&&(v=`${c.adminfirstname} ${c.adminlastname}`,I=c)}M(e,o,a,v,I),R(o,C),j(d),H(e)}catch(e){console.error("Unexpected error:",e),alert("An error occurred while loading details.")}}function M(n,e,t,i,o){N.textContent=n.complainttitle||"Untitled",L.textContent=`#${n.complaintid}`;const a=new Date(n.submitteddate);if(_.textContent=isNaN(a)?"N/A":a.toLocaleString(),g.textContent=n.complaintstatus,g.className=`px-3 py-1 rounded-full text-xs font-bold border inline-block ${W(n.complaintstatus)}`,g.classList.remove("hidden"),S.textContent=n.complaintdescription||"No description provided.",t)if(w.textContent=`${t.first_name||""} ${t.last_name||""}`,B.textContent=t.role||"Student",y.textContent=t.id||"N/A",y.title=t.id||"",k.textContent=t.email||"N/A",A.textContent=t.department||"N/A",t.profile_image_url)f.src=t.profile_image_url,f.classList.remove("hidden"),p.classList.add("hidden");else{const d=t.first_name?t.first_name[0]:"",r=t.last_name?t.last_name[0]:"";p.innerText=(d+r).toUpperCase()||"U",f.classList.add("hidden"),p.classList.remove("hidden")}else w.textContent="Unknown User",B.textContent="N/A",y.textContent="N/A",k.textContent="N/A",A.textContent="N/A",p.innerText="U",f.classList.add("hidden"),p.classList.remove("hidden");if(F.textContent=i,o&&o.profile_pic)b.src=o.profile_pic,b.classList.remove("hidden"),h.classList.add("hidden");else{const d=i!=="Unassigned"?i.split(" ").map(r=>r[0]).join("").substring(0,2).toUpperCase():"?";h.textContent=d,h.classList.remove("hidden"),b.classList.add("hidden")}}function R(n,e){if(!e)return;P.classList.remove("hidden"),T.textContent=n,E.textContent="";const t=(i,o)=>{const a=q.content.cloneNode(!0),d=a.querySelector(".field-label"),r=a.querySelector(".field-value");d.textContent=i,r.textContent=o||"N/A",o||r.classList.add("italic","text-gray-400"),E.appendChild(a)};n==="Technical"?(t("Type of Issue",e.typeofissue),t("Device Affected",e.deviceaffected),t("Previous Attempts",e.previousattempts)):n==="Student Disciplinary"?(t("Accused Name",e.accusedname),t("Type of Behavior",e.typeofbehavior),t("Location",e.locationofincident),t("Witness Details",e.witnessdetail),t("Previous Attempts",e.previousattempts)):n==="Facility"?(t("Facility Type",e.typeoffacility),t("Issue",e.typeoffacilityissue),t("Floor",e.facilityfloor),t("Previous Attempt",e.previousattempt)):n==="Administrative"?(t("Department",e.complaintdepartment),t("Staff Involved",e.staffinvolved),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts)):n==="Academic"?(t("Lecturer Name",e.lecturername),t("Module Name",e.modulename),t("Batch Code",e.batchcode),t("Level",e.currentlevel),t("Semester",e.semester),t("Issue",e.specificationofissue),t("Phone",e.phone),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts)):n==="Other"&&(t("Suggested Category",e.suggestedcategory),t("Desired Outcome",e.desiredoutcome),t("Previous Attempts",e.previousattempts))}function j(n){if(!n||n.length===0){u.textContent="";const e=document.createElement("p");e.className="text-gray-500 text-sm italic",e.textContent="No attachments found.",u.appendChild(e);return}u.textContent="",n.forEach(e=>{const t=U.content.cloneNode(!0),i=t.querySelector(".attachment-link"),o=t.querySelector(".attachment-filename"),a=t.querySelector(".attachment-desc");i.href=e.fileurl,o.textContent=e.filename,a.textContent=e.description||"Attachment",u.appendChild(t)})}function H(n){D.textContent="";const e=document.createElement("p");n.admin_feedback?(e.className="text-gray-700 dark:text-gray-300 whitespace-pre-wrap",e.textContent=n.admin_feedback):(e.className="text-gray-500 text-sm italic",e.textContent="No feedback provided yet."),D.appendChild(e)}function W(n){switch(n){case"Pending":return"bg-yellow-100 text-yellow-800 border-yellow-200 dark:bg-yellow-900/30 dark:text-yellow-300 dark:border-yellow-800";case"In-Progress":return"bg-blue-100 text-blue-800 border-blue-200 dark:bg-blue-900/30 dark:text-blue-300 dark:border-blue-800";case"Resolved":return"bg-green-100 text-green-800 border-green-200 dark:bg-green-900/30 dark:text-green-300 dark:border-green-800";case"Deleted":return"bg-red-100 text-red-800 border-red-200 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}}
