import{s}from"./darkMode-C5bWaft0.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:u}}=await s.auth.getSession();if(!u){window.location.href="Login.html";return}const c=new URLSearchParams(window.location.search).get("id");if(!c){alert("No found item ID provided"),window.location.href="AdminLostFound.html";return}await g(c),f();async function g(r){try{const{data:e,error:a}=await s.from("found_items").select("*").eq("found_item_id",r).single();if(a)throw a;console.log("Found item loaded:",e);let t=null;try{const{data:o,error:d}=await s.from("admin").select("adminfirstname, adminlastname, adminrole, profile_pic").eq("id",e.admin_id).single();d?console.error("Admin fetch error:",d):t=o}catch(o){console.error("Admin fetch failed:",o)}const{data:i,error:m}=await s.from("lost_found_attachments").select("*").eq("found_item_id",r);m&&console.error("Attachments error:",m),document.getElementById("databaseId").textContent=e.found_item_id,document.getElementById("itemName").textContent=e.item_name||"N/A",document.getElementById("itemTypeDisplay").textContent=e.item_type||"N/A";const n=document.getElementById("statusBadge");if(n.textContent=e.status,e.status==="Unclaimed"?n.className="px-4 py-1.5 rounded-full text-sm font-bold bg-yellow-100 text-yellow-800 shadow-md":e.status==="Claimed"&&(n.className="px-4 py-1.5 rounded-full text-sm font-bold bg-green-100 text-green-800 shadow-md"),document.getElementById("uploadedDate").textContent=e.created_at?new Date(e.created_at).toLocaleDateString():"N/A",document.getElementById("dateFound").textContent=e.date_found?new Date(e.date_found).toLocaleDateString():"N/A",document.getElementById("timeFound").textContent=e.time_found||"N/A",document.getElementById("locationFound").textContent=e.location_found||"N/A",document.getElementById("brand").textContent=e.brand||"--",document.getElementById("model").textContent=e.model||"--",document.getElementById("serialNumber").textContent=e.serial_number||"--",document.getElementById("primaryColor").textContent=e.primary_color||"--",document.getElementById("secondaryColor").textContent=e.secondary_color||"--",document.getElementById("distFeatures").textContent=e.distinguishing_features||"None specified",document.getElementById("description").textContent=e.description||"No description provided",t){const o=`${t.adminfirstname||""} ${t.adminlastname||""}`.trim()||"Unknown Admin";document.getElementById("adminName").textContent=`${o} (${t.adminrole||"Admin"})`;const d=`${t.adminfirstname?.[0]||""}${t.adminlastname?.[0]||""}`.toUpperCase()||"A";document.getElementById("adminInitials").textContent=d}else document.getElementById("adminName").textContent="Admin Info Unavailable",document.getElementById("adminInitials").textContent="A";if(i&&i.length>0){const o=document.getElementById("imageContainer");o.innerHTML="",i.forEach(d=>{const l=document.createElement("img");l.src=d.file_url,l.alt="Found Item Image",l.className="h-48 w-auto rounded-lg border-2 border-gray-200 dark:border-gray-700 object-cover cursor-pointer hover:scale-105 transition-transform",l.onclick=()=>window.open(d.file_url,"_blank"),o.appendChild(l)})}}catch(e){console.error("Error loading found item:",e),alert("Failed to load found item details"),window.location.href="AdminLostFound.html"}}function f(){const r=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu");r&&e&&r.addEventListener("click",()=>{e.classList.toggle("-translate-x-full")});const a=document.getElementById("profileButton"),t=document.getElementById("profileMenu");a&&t&&(a.addEventListener("click",n=>{n.stopPropagation(),t.classList.toggle("hidden")}),document.addEventListener("click",n=>{!a.contains(n.target)&&!t.contains(n.target)&&t.classList.add("hidden")}));const i=document.getElementById("headerLogoutBtn"),m=document.getElementById("logoutModal");if(i&&m){i.addEventListener("click",()=>m.classList.remove("hidden"));const n=document.getElementById("cancelLogoutBtn"),o=document.getElementById("confirmLogoutBtn");n&&(n.onclick=()=>m.classList.add("hidden")),o&&(o.onclick=async()=>{await s.auth.signOut(),window.location.href="Login.html"})}}});
