import{s as n}from"./darkMode-DwWyDh1G.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:s}}=await n.auth.getSession();if(s&&s.user){const a=s.user.id,{data:t}=await n.from("admin").select("id, adminrole").eq("id",a).single();if(t){t.adminrole==="LostAndFound Admin"?window.location.href="AdminLostFoundDashboard.html":window.location.href="AdminDashboard.html";return}const{data:m}=await n.from("users").select("id").eq("id",a).single();if(m){window.location.href="UserDashboard.html";return}}const o=document.getElementById("password"),d=document.getElementById("togglePassword"),e=document.getElementById("eyeIcon"),r=document.getElementById("eyeOffIcon");d&&d.addEventListener("click",()=>{o.type==="password"?(o.type="text",e.classList.remove("hidden"),r.classList.add("hidden")):(o.type="password",e.classList.add("hidden"),r.classList.remove("hidden"))})});document.getElementById("loginForm").addEventListener("submit",async s=>{s.preventDefault();const o=document.getElementById("email").value,d=document.getElementById("password").value;try{const{data:e,error:r}=await n.auth.signInWithPassword({email:o,password:d});if(r){alert("Login failed: "+r.message);return}if(!e||!e.user){alert("Login failed: No user data returned.");return}const a=e.user.id,{data:t,error:m}=await n.from("admin").select("adminfirstname, adminlastname, adminrole").eq("id",a).single();if(t){localStorage.setItem("isAdminLoggedIn","true"),localStorage.setItem("adminId",a),localStorage.setItem("adminFirstName",t.adminfirstname),localStorage.setItem("adminLastName",t.adminlastname),localStorage.setItem("adminRole",t.adminrole),t.adminrole==="LostAndFound Admin"?window.location.href="AdminLostFoundDashboard.html":window.location.href="AdminDashboard.html";return}const{data:i,error:l}=await n.from("users").select("first_name, last_name, username").eq("id",a).single();if(i){localStorage.setItem("userId",a),localStorage.setItem("firstName",i.first_name),localStorage.setItem("lastName",i.last_name),localStorage.setItem("username",i.username),window.location.href="UserDashboard.html";return}alert("Login successful, but no profile found in Admin or Users table."),await n.auth.signOut()}catch(e){console.error("Login error:",e),alert("Unexpected error: "+e.message)}});
