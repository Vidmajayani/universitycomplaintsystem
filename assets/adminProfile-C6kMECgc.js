import{s as d}from"./supabaseClient-DP-aSKaS.js";import"./darkMode-DIftV1Qz.js";const u=document.getElementById("adminName"),f=document.getElementById("adminRole"),g=document.getElementById("adminEmail"),E=document.getElementById("adminId"),c=document.getElementById("totalHandled"),r=document.getElementById("logoutBtn"),s=document.getElementById("headerLogoutBtn"),m=document.getElementById("defaultProfileIcon"),l=document.getElementById("profileImage");document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:t}}=await d.auth.getSession();if(!t){window.location.href="Login.html";return}document.getElementById("mainContent").classList.remove("hidden"),h(),y()});async function h(){const{data:{session:t}}=await d.auth.getSession();if(!t){window.location.href="Login.html";return}const{data:e,error:n}=await d.from("admin").select("*").eq("id",t.user.id).single();if(n||!e){console.error("Error fetching admin data:",n),alert("Failed to load profile.");return}if(u.textContent=`${e.adminfirstname} ${e.adminlastname}`,f.textContent=e.adminrole,g.textContent=e.adminemail,E.textContent=e.id,e.profile_pic){l.src=e.profile_pic,l.classList.remove("hidden"),m.classList.add("hidden");const o=document.getElementById("profileButton");o&&(o.innerHTML=`
                <img src="${e.profile_pic}" alt="Profile" class="h-10 w-10 rounded-full object-cover border-2 border-white dark:border-gray-600 shadow-sm">
            `)}else l.classList.add("hidden"),m.classList.remove("hidden");L(e.id,e.adminrole)}async function L(t,e){try{let n=d.from("complaint").select("complaintid",{count:"exact",head:!0});e!=="Master Admin"&&(n=n.eq("adminid",t));const{count:o,error:i}=await n;if(i)throw i;c.textContent=o||0}catch(n){console.error("Error loading stats:",n),c.textContent="-"}}function y(){r&&r.addEventListener("click",a),s&&s.addEventListener("click",a);const t=document.getElementById("logoutModal");if(t){const n=document.getElementById("cancelLogoutBtn"),o=document.getElementById("confirmLogoutBtn");n&&n.addEventListener("click",()=>{t.classList.add("hidden")}),o&&o.addEventListener("click",async()=>{const{error:i}=await d.auth.signOut();i&&console.error("Error signing out:",i),window.location.href="Login.html"}),t.addEventListener("click",i=>{i.target===t&&t.classList.add("hidden")})}const e=setInterval(()=>{const n=document.querySelector('#mobileMenu a[href="Login.html"]');if(n)n.addEventListener("click",a),clearInterval(e);else if(document.readyState==="complete"){const o=document.querySelector('#mobileMenu a[href="Login.html"]');o&&o.addEventListener("click",a),clearInterval(e)}},100)}function a(t){t&&t.preventDefault();const e=document.getElementById("logoutModal");e&&e.classList.remove("hidden")}
