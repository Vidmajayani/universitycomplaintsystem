import{s as l}from"./darkMode-0kXEi02e.js";document.addEventListener("DOMContentLoaded",async()=>{const{data:{session:L}}=await l.auth.getSession();if(!L){window.location.href="Login.html";return}const p=new URLSearchParams(window.location.search).get("id");if(!p){alert("No found item ID provided"),window.location.href="AdminLostFound.html";return}await x(p),N();async function x(c){try{const{data:e,error:t}=await l.from("found_items").select("*").eq("found_item_id",c).single();if(t)throw t;console.log("Found item loaded:",e);let o=null;try{const{data:a,error:i}=await l.from("admin").select("adminfirstname, adminlastname, adminrole, profile_pic").eq("id",e.admin_id).single();i?console.error("Admin fetch error:",i):o=a}catch(a){console.error("Admin fetch failed:",a)}const{data:n,error:m}=await l.from("lost_found_attachments").select("*").eq("found_item_id",c);m&&console.error("Attachments error:",m),document.getElementById("databaseId").textContent=e.found_item_id,document.getElementById("itemName").textContent=e.item_name||"N/A",document.getElementById("itemTypeDisplay").textContent=e.item_type||"N/A";const d=document.getElementById("statusBadge");if(d.textContent=e.status,e.status==="Unclaimed"?d.className="px-4 py-1.5 rounded-full text-sm font-bold bg-yellow-100 text-yellow-800 shadow-md":e.status==="Claimed"&&(d.className="px-4 py-1.5 rounded-full text-sm font-bold bg-green-100 text-green-800 shadow-md"),document.getElementById("uploadedDate").textContent=e.created_at?new Date(e.created_at).toLocaleDateString():"N/A",document.getElementById("dateFound").textContent=e.date_found?new Date(e.date_found).toLocaleDateString():"N/A",document.getElementById("timeFound").textContent=e.time_found||"N/A",document.getElementById("locationFound").textContent=e.location_found||"N/A",document.getElementById("brand").textContent=e.brand||"--",document.getElementById("model").textContent=e.model||"--",document.getElementById("serialNumber").textContent=e.serial_number||"--",document.getElementById("primaryColor").textContent=e.primary_color||"--",document.getElementById("secondaryColor").textContent=e.secondary_color||"--",document.getElementById("distFeatures").textContent=e.distinguishing_features||"None specified",document.getElementById("description").textContent=e.description||"No description provided",o){const a=`${o.adminfirstname||""} ${o.adminlastname||""}`.trim()||"Unknown Admin";document.getElementById("adminName").textContent=`${a} (${o.adminrole||"Admin"})`;const i=`${o.adminfirstname?.[0]||""}${o.adminlastname?.[0]||""}`.toUpperCase()||"A";document.getElementById("adminInitials").textContent=i}else document.getElementById("adminName").textContent="Admin Info Unavailable",document.getElementById("adminInitials").textContent="A";if(n&&n.length>0){const a=document.getElementById("imageContainer");a.innerHTML="",n.forEach(i=>{const r=document.createElement("img");r.src=i.file_url,r.alt="Found Item Image",r.className="h-48 w-auto rounded-lg border-2 border-gray-200 dark:border-gray-700 object-cover cursor-pointer hover:scale-105 transition-transform",r.onclick=()=>window.open(i.file_url,"_blank"),a.appendChild(r)})}e.status==="Claimed"&&e.matched_lost_item_id&&await w(e.matched_lost_item_id,e.claim_date)}catch(e){console.error("Error loading found item:",e),alert("Failed to load found item details"),window.location.href="AdminLostFound.html"}}async function w(c,e){try{const{data:t,error:o}=await l.from("lost_and_found").select("item_id, item_name, item_type, location_lost, reported_date, user_id").eq("item_id",c).single();if(o||!t){console.error("Error loading matched lost item:",o);return}const{data:n,error:m}=await l.from("users").select("id, first_name, last_name, email, profile_image_url").eq("id",t.user_id).single();m&&console.error("Error loading reporter:",m);const d=document.getElementById("matchedLostItemCard");d&&d.classList.remove("hidden");const a=document.getElementById("matchedLostId");a&&(a.textContent=t.item_id);const i=document.getElementById("matchedLostItemName");i&&(i.textContent=t.item_name||"N/A");const r=document.getElementById("matchedLostItemType");r&&(r.textContent=t.item_type||"N/A");const y=document.getElementById("matchedLostLocation");if(y&&(y.textContent=t.location_lost||"N/A"),n){const g=`${n.first_name||""} ${n.last_name||""}`.trim()||"Unknown User",h=`${n.first_name?.[0]||"U"}${n.last_name?.[0]||""}`.toUpperCase(),s=document.getElementById("matchedReporterName");s&&(s.textContent=g);const u=document.getElementById("matchedReporterEmail");u&&(u.textContent=n.email||"N/A");const B=document.getElementById("matchedReporterId");B&&(B.textContent=n.id);const C=document.getElementById("matchedReporterInitials");C&&(C.textContent=h);const f=document.getElementById("matchedReporterProfilePic"),I=document.getElementById("matchedReporterInitials");n.profile_image_url&&f&&I?(f.src=n.profile_image_url,f.classList.remove("hidden"),I.classList.add("hidden")):I&&(I.classList.remove("hidden"),f&&f.classList.add("hidden"))}else{const g=document.getElementById("matchedReporterName");g&&(g.textContent="Unknown User");const h=document.getElementById("matchedReporterEmail");h&&(h.textContent="N/A");const s=document.getElementById("matchedReporterId");s&&(s.textContent=t.user_id);const u=document.getElementById("matchedReporterInitials");u&&(u.textContent="U")}const E=document.getElementById("matchedReportedDate");E&&(E.textContent=t.reported_date?new Date(t.reported_date).toLocaleDateString():"N/A");const _=document.getElementById("matchedDateReceived");_&&(_.textContent=e?new Date(e).toLocaleDateString():"N/A")}catch(t){console.error("Error fetching matched lost item:",t)}}function N(){const c=document.getElementById("mobileMenuButton"),e=document.getElementById("mobileMenu");c&&e&&c.addEventListener("click",()=>{e.classList.toggle("-translate-x-full")});const t=document.getElementById("profileButton"),o=document.getElementById("profileMenu");t&&o&&(t.addEventListener("click",d=>{d.stopPropagation(),o.classList.toggle("hidden")}),document.addEventListener("click",d=>{!t.contains(d.target)&&!o.contains(d.target)&&o.classList.add("hidden")}));const n=document.getElementById("headerLogoutBtn"),m=document.getElementById("logoutModal");if(n&&m){n.addEventListener("click",()=>m.classList.remove("hidden"));const d=document.getElementById("cancelLogoutBtn"),a=document.getElementById("confirmLogoutBtn");d&&(d.onclick=()=>m.classList.add("hidden")),a&&(a.onclick=async()=>{await l.auth.signOut(),window.location.href="Login.html"})}}});
